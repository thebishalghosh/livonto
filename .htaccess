# Enable Rewrite Engine
RewriteEngine On

# Force HTTPS
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Don't rewrite files and directories that exist (this handles CSS, JS, images, etc.)
# This must come FIRST to allow direct access to assets
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Don't rewrite assets by extension (backup check)
RewriteCond %{REQUEST_URI} \.(css|js|jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot)$ [NC]
RewriteRule ^ - [L]

# Explicitly allow admin/assets directory - must come before admin route rule
RewriteCond %{REQUEST_URI} ^/admin/assets/ [NC]
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Handle admin routes - always route through index.php even if directory exists
# But exclude admin/assets directory and asset files
RewriteCond %{REQUEST_URI} admin/ [NC]
RewriteCond %{REQUEST_URI} !admin/assets/ [NC]
RewriteCond %{REQUEST_URI} !admin/.*\.(css|js|jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot)$ [NC]
RewriteRule ^(.*)$ index.php?url=$1 [QSA,L]

# Allow direct access to actual files in app, storage, vendor, sql directories
RewriteCond %{REQUEST_URI} (app|storage|vendor|sql)/ [NC]
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Route all other requests to index.php
RewriteRule ^(.*)$ index.php?url=$1 [QSA,L]

# Remove .php extension from URLs (optional - for direct access)
RewriteCond %{THE_REQUEST} /public/([^?\s]*?)\.php[\s?] [NC]
RewriteRule ^ /%1? [R=301,L]

# Force trailing slash removal (optional)
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} (.+)/$
RewriteRule ^ %1 [R=301,L]
